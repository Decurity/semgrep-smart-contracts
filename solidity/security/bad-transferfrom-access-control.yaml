rules:
  - id: bad-transferfrom-access-control
    languages:
      - solidity
    severity: ERROR
    message: An attacker may perform transferFrom() with arbitrary addresses
    metadata:
      category: security
      technology:
        - solidity
      cwe: "CWE-284: Improper Access Control"
      confidence: LOW
      likelihood: HIGH
      impact: HIGH
      subcategory:
        - vuln
      references: 
        - https://app.blocksec.com/explorer/tx/eth/0x54f659773dae6e01f83184d4b6d717c7f1bb71c0aa59e8c8f4a57c25271424b3 # YODL hack
    mode: taint
    pattern-sources:
      - label: INPUT_TO
        pattern-either:
          - patterns:
              - pattern: function $F(..., address $FROM, ..., address $TO, ...) public { ... }
              - focus-metavariable: $TO
          - patterns:
              - pattern: function $F(..., address $FROM, ..., address $TO, ...) external { ... }
              - focus-metavariable: $TO
      - label: INPUT_FROM
        pattern-either:
          - patterns:
              - pattern: function $F(..., address $FROM, ..., address $TO, ...) public { ... }
              - focus-metavariable: $FROM
          - patterns:
              - pattern: function $F(..., address $FROM, ..., address $TO, ...) external { ... }
              - focus-metavariable: $FROM
    pattern-sinks:
      - requires: INPUT_TO and INPUT_FROM
        pattern-either:
          - pattern: $TOKEN.transferFrom($FROM,$TO,$AMOUNT);
          - pattern: $TOKEN.safeTransferFrom($FROM,$TO,$AMOUNT);
          - pattern: $HELPER.transferFrom($TOKEN,$FROM,$TO,...);
          - pattern: $HELPER.safeTransferFrom($TOKEN,$FROM,$TO,...);
