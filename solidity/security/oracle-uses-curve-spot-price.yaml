rules:
 -
    id: oracle-uses-curve-spot-price
    message: Oracle uses the get_p() curve pool function which can be 
manipulated via flashloan to calculate the asset price 
    metadata:
        category: security
        technology:
            - solidity
        cwe: "CWE-682: Incorrect Calculation"
        confidence: LOW
        likelihood: LOW
        impact: HIGH
        subcategory:
            - vuln
        references:
            - https://x.com/danielvf/status/1800556249924440211
            - 
https://slowmist.medium.com/analysis-of-the-uwu-lend-hack-9502b2c06dbe
            - 
https://defimon.xyz/attacker/mainnet/0x841ddf093f5188989fa1524e7b893de64b421f47
            - https://x.com/CyversAlerts/status/1800139071857316328
    mode: taint
    pattern-sources:
      - patterns:
          - pattern: $CONTRACT.get_p($I)
          - pattern-not: $CONTRACT.get_p($I, $OTHER, ...)
          - metavariable-regex:
              metavariable: $I
              regex: '[0-9]'

    pattern-sinks:
      - patterns:
        - pattern-inside: |
            function $F(...) {
              ...
            }
        - pattern: return ...;
        - metavariable-regex:
            metavariable: $F
            regex: _*(?i)get([a-z0-9_])*price
    languages: 
        - solidity
    severity: ERROR

