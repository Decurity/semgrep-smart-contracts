rules:
  - id: external-call-return-value-not-checked
    message: Functions call, staticcall, delegatecall, send returns a boolean indicating whether the call completed successfully. Not testing explicitly whether these calls fail may lead to unexpected behavior in the caller contract.
    languages:
      - solidity
    severity: WARNING
    metadata:
      references:
        - https://entethalliance.org/specs/ethtrust-sl/v1/#req-1-check-return
      tags:
        - ethtrust
        - external-call
    patterns:
      - pattern-either:
          - pattern: (bool $SUCC, ) = $ADDR.$METHOD(...);
          - pattern: (bool $SUCC, ) = $ADDR.$METHOD{value:$VAL}(...);
          - pattern: (bool $SUCC, ) = $ADDR.$METHOD{gas:$GAS}(...);
          - pattern: (bool $SUCC, ) = $ADDR.$METHOD{value:$VAL, gas:$GAS}(...);
          - pattern: (bool $SUCC, ) = $ADDR.$METHOD{gas:$GAS, value:$VAL}(...);
          - pattern: (bool $SUCC, bytes memory $DATA) = $ADDR.$METHOD(...);
          - pattern: (bool $SUCC, bytes memory $DATA) = $ADDR.$METHOD{value:$VAL}(...);
          - pattern: (bool $SUCC, bytes memory $DATA) = $ADDR.$METHOD{gas:$GAS}(...);
          - pattern: (bool $SUCC, bytes memory $DATA) = $ADDR.$METHOD{value:$VAL,
              gas:$GAS}(...);
          - pattern: (bool $SUCC, bytes memory $DATA) = $ADDR.$METHOD{gas:$GAS,
              value:$VAL}(...);
          - pattern: $ADDR.$METHOD(...);
          - pattern: $ADDR.$METHOD{value:$VAL}(...);
          - pattern: $ADDR.$METHOD{gas:$GAS}(...);
          - pattern: $ADDR.$METHOD{value:$VAL, gas:$GAS}(...);
          - pattern: $ADDR.$METHOD{gas:$GAS, value:$VAL}(...);
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(call|delegatecall|staticcall|send)$ 
      - pattern-not-inside: |
          function $FUNC(...){
            ...
            require(<... $SUCC ...>, ...);
            ...
          } 
      - pattern-not-inside: |
          function $FUNC(...){
            ...
            if (<... $SUCC ...>){
              ...
            }
            ...
          } 
      - pattern-not-inside: |
          function $FUNC(...){
            ...
            return <... $SUCC ...>;
          } 
      - pattern-not-inside: |
          function $FUNC(...){
            ...
            $CHECK(..., $SUCC, ...);
            ...
          }   
      - pattern-not-inside: |
          function $FUNC(...){
            ...
            assert(<... $SUCC ...>);
            ...
          }  

